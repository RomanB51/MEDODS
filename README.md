# MEDODS
Часть сервиса аутентификации с использованием JWT.
<!--Блок информации о репозитории в бейджах-->
![Static Badge](https://img.shields.io/badge/RomanB51-REST_API-7CFC00)
![Static Badge](https://img.shields.io/badge/Go-1.22.2-blue)
![Static Badge](https://img.shields.io/badge/Fiber-V2-red)
![Static Badge](https://img.shields.io/badge/PostgreSQL-16.6-CD853F)
<!-- описание репозитория -->
 Данное API представляет собой часть сервиса аутентификации с помощью JWT токенов. Список открытых сессий хранится в БД PostgreSQL. 

<img src="https://github.com/RomanB51/Image_for_readme/blob/main/Image_for_MEDODS/74aa73433fa4ff3cb89cab06b90fee29.jpg" alt="logo" width="200"/>

<!--Внимание-->
## ВНИМАНИЕ!
Не удалось реализовать Payload Refresh токена таким образом, чтобы он содержал ip адрес клиента, которому он был выдан. Это связано с тем, что метод SigningMethodHS256 формирует токены размером больше 72 кБ, а метод bcrypt.GenerateFromPassword не может обрабатывать пароли более 72 кб. Таким образом, приходится выбирать, либо хранить Refresh токена в виде bcrypt хеша в БД, но без ip-адреса в Payload, либо формировать Refresh токен с помощью метода SigningMethodHS256 и помещать внутрь Payload ip-адрес, но тогда не получится хранить его в виде хэша в БД, так как сформированный токен больше 72 кб.

Маршрут app.Get("/secret", GetSecretData) реализован исключительно для личного развития и к заданию никак не относится.
Фреймворк Fiber использован также для личного развития.

<!--Установка-->
## Клонирование репозитория

```https://github.com/RomanB51/MEDODS.git```

<!--Пользовательская документация-->
## Документация
Пользовательскую документацию по реализованным функциям можно получить по [этой ссылке](./docs/ru/readme.md).

<!--Поддержка-->
## Поддержка
Если у вас возникли сложности или вопросы по использованию пакета, создайте 
[обсуждение](https://github.com/RomanB51/Project/issues/new) в данном репозитории или напишите на электронную почту <bychkovr51@mail.ru>.

<!--Зависимости-->
## Зависимости
Данное ПО зависит от версии Golang 1.22.2 и фреймворка Fiber V2. Для взаимодействия с PostgreSQL использовалась библиотека pgx.

<!--Особеннсоти-->
## Особенности
Время жизни access токена 1 минута, время жизни refresh токена 2 минуты. Время жизни access токена зашифровано в payload самого токена, а момент создания refresh хранится в БД.

<!--Результат работы-->
## Результат работы
Открытие сессии:

*Открытие сессии и получение токенов в cookies:*
![image](https://github.com/RomanB51/Image_for_readme/blob/main/Image_for_MEDODS/Постман%20авторизация.png)
*Открытие сессии в БД:*
![image](https://github.com/RomanB51/Image_for_readme/blob/main/Image_for_MEDODS/Постгрес%20авторизация.png)

Что происходит?
Клиент отправляет на сервер Get запрос, в заголовке указан GUID пользователя. После этого происходит генерация двух токенов. Refresh токен шифруется и помещается в БД вместе с GUID пользователя. Access и Refresh токен помещаются в cookies.
Refresh операция:

*Refresh операция:*
![image](https://github.com/RomanB51/Image_for_readme/blob/main/Image_for_MEDODS/Постман%20рефреш%20операция.png)
*БД после Refresh операции:*
![image](https://github.com/RomanB51/Image_for_readme/blob/main/Image_for_MEDODS/Постгрес%20рефреш%20операция.png)

Что происходит?
Клиент отправляет на сервер Post запрос, в заголовке указаны GUID пользователя и refresh токен. После этого происходит проверка refresh токена на правильность и время жизни, если все ок, то происходит генерация двух токенов. После этого в БД обновляются refresh токен и время его создания для данного пользователя. После этого Access и Refresh токены помещаются в cookies.
